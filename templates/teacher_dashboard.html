<!DOCTYPE html>
<html>
<head>
    <title>Teacher Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body{
            background: linear-gradient(135deg,#1c1c1c,#232526,#414345);
            color:white;
            min-height:100vh;
        }
        .card-box{
            background:rgba(255,255,255,.08);
            border-radius:12px;
            padding:30px;
            backdrop-filter: blur(8px);
        }
        .link-box{
            background:#111;
            padding:10px;
            border-radius:6px;
            word-break:break-all;
        }
        .timer{
            font-size:28px;
            font-weight:bold;
        }
        @media(max-width:768px){

    .container{
        padding:15px!important;
    }

    h1,h2,h3{
        font-size:22px!important;
    }

    .card-box{
        padding:18px!important;
    }

    video{
        width:100%!important;
        height:auto!important;
    }

    table{
        font-size:14px;
    }

    .btn{
        width:100%;
        margin-top:8px;
    }

}
    </style>
</head>

<body>

<div class="container mt-5">

    <h2>Teacher Dashboard</h2>
    <p class="text-muted">Subject: <b>{{ subject }}</b></p>

    <div class="card-box mt-4">

        {% if not session_active %}

            <h4>Start Attendance Session</h4>

            <form method="POST">
                <input type="hidden" name="action" value="start">
                <button class="btn btn-success btn-lg">
                    Start Session
                </button>
            </form>

        {% else %}

            <h4 class="text-success">Session Active</h4>

            <p class="mt-3">Time remaining:</p>
            <div class="timer text-warning" id="timer"></div>

            <h5 class="mt-4">Attendance Link</h5>

            <div class="link-box">
                <span id="linkText">{{ scan_link }}</span>
            </div>

            <button class="btn btn-primary mt-3" onclick="copyLink()">
                Copy Link
            </button>

            <form method="POST" class="mt-3">
                <input type="hidden" name="action" value="stop">
                <button class="btn btn-danger">
                    Stop Session
                </button>
            </form>

        {% endif %}

    </div>

</div>

<script>
function copyLink(){
    let text = document.getElementById("linkText").innerText;
    navigator.clipboard.writeText(text);
    alert("Link copied!");
}

// LIVE TIMER
let seconds = parseInt("{{ time_left if time_left else 0 }}");
let timerBox = document.getElementById("timer");

function updateTimer(){
    if(seconds <= 0){
        location.reload();
        return;
    }
    let m = Math.floor(seconds/60);
    let s = seconds%60;
    timerBox.innerText = m + " : " + (s<10?"0"+s:s);
    seconds--;
}

if(timerBox){
    updateTimer();
    setInterval(updateTimer,1000);
}
</script>

</body>
</html>